!function(t){"use strict";t(window).on("load",(function(){if("undefined"!=typeof pwplData){pwplData.posts={},pwplData.taxonomies={};const o=t=>{let o=null;return void 0!==pwplData.posts[t]&&(o=pwplData.posts[t]),o},s=(t,o)=>{let s=null;const a=o.toString();return void 0===pwplData.taxonomies[t]||void 0===pwplData.taxonomies[t][a]||(s=pwplData.taxonomies[t][a]),s},a=t=>null!==o(t),p=(t,o)=>null!==s(t,o),e=t=>`${t.title} (${t.id})`,n=t=>{let o=null;for(const s in pwplData.posts){const a=pwplData.posts[s];if(t===e(a)){o=a;break}}return o},l=(t,o)=>{let s=null;if(void 0!==pwplData.taxonomies[t])for(const a in pwplData.taxonomies[t]){const p=pwplData.taxonomies[t][a];if(o===e(p)){s=p;break}}return s},i=t=>{if(t.posts)for(const o in t.posts){const s=t.posts[o];s.id&&s.title&&s.slug&&(pwplData.posts[s.id.toString()]=s)}if(t.taxonomies)for(const o in t.taxonomies){let s=t.taxonomies[o];for(const t in s){let a=s[t];a.id&&a.title&&a.slug&&(void 0===pwplData.taxonomies[o]&&(pwplData.taxonomies[o]={}),pwplData.taxonomies[o][t.toString()]=a)}}},c=()=>{const o={action:pwplData.getPostAndTermMeta.action,nonce:pwplData.getPostAndTermMeta.nonce,postIds:[],taxonomies:{}};let s=0;t("[data-pp-post-chooser], [data-pp-term-chooser]").each((function(e,n){const l=t(this),i=t(this).find(".list-pills+input"),c=null!=l.data("pp-post-chooser"),r=null!=l.data("pp-term-chooser");let d=null;r&&(d=l.data("pp-term-chooser").taxonomy);t(i).val().split(",").forEach((t=>{(t=parseInt(t))<=0||(!c||a(t)||o.postIds[t]?r&&!p(d,t)&&(void 0===o.taxonomies[d]&&(o.taxonomies[d]=[]),o.taxonomies[d].includes(t)||(o.taxonomies[d].push(t),++s)):(o.postIds.push(t),++s))}))})),s>0&&(r(),t.post(pwplData.ajaxUrl,o).done(((t,o)=>{i(t),h()})).always((()=>{d()})))},r=()=>{t("[data-pp-post-chooser] input.search-posts, [data-pp-term-chooser]  input.search-terms").prop("disabled",!0)},d=()=>{t("[data-pp-post-chooser] input.search-posts, [data-pp-term-chooser]  input.search-terms").prop("disabled",!1)};function u(o,s){const a=t(this.element).attr("id"),p=t(this.element).closest("[data-pp-post-chooser], [data-pp-term-chooser]"),n=(t(this).find(".list-pills+input"),null!=p.data("pp-post-chooser")),l=null!=p.data("pp-term-chooser");let c=null,r=null,d=null;l&&(c=p.data("pp-term-chooser").taxonomy),n?(d=t(p).data("pp-post-chooser"),r={searchType:"posts",postType:d.postType,searchQuery:o.term}):l&&(d=t(p).data("pp-term-chooser"),r={searchType:"terms",taxonomy:d.taxonomy,searchQuery:o.term}),r&&(r.action=pwplData.searchPostOrTerms.action,r.nonce=pwplData.searchPostOrTerms.nonce,d.queryHandle&&(r.queryHandle=d.queryHandle),a&&(r.controlId=a),t.post(pwplData.ajaxUrl,r).done(((t,o)=>{const a=[];if(i(t),t&&t.posts)for(const o in t.posts)a.push(e(t.posts[o]));if(t.taxonomies)for(const o in t.taxonomies){let s=t.taxonomies[o];for(const t in s){let o=s[t];a.push(e(o))}}a.length>0?s(a):s([])})).always((()=>{})))}const m=(o,s)=>{const a=t(o.target),p=(t(a).attr("id"),t(a).closest("[data-pp-post-chooser], [data-pp-term-chooser]")),e=t(p).find(".list-pills+input"),i=null!=p.data("pp-post-chooser"),c=null!=p.data("pp-term-chooser");let r=null;c&&(r=p.data("pp-term-chooser").taxonomy);const d=s.item.label;if(i){const t=n(d);t&&(e.val(e.val()+","+t.id),h())}else if(c&&r){const t=l(r,d);t&&(e.val(e.val()+","+t.id),h())}setTimeout((function(){t(a).val(" ")}),250)},h=()=>{t("[data-pp-post-chooser], [data-pp-term-chooser]").each((function(n,l){const i=t(this),c=i.find(".list-pills+input"),r=i.find(".list-pills"),d=null!=i.data("pp-post-chooser"),u=null!=i.data("pp-term-chooser");let m=null;u&&(m=i.data("pp-term-chooser").taxonomy),t(r).empty();const h=t(c).val().split(","),w=[];h.forEach((n=>{let l=null;if((n=parseInt(n))<=0||(d&&a(n)?l=o(n):u&&p(m,n)&&(l=s(m,n))),l)if(w.includes(n));else{const o=t(`<div class="list-pill" data-item-id="${n}"><span>${e(l)}</span></div>`),s=t('<button><span class="dashicons dashicons-no-alt"></span></button>');s.click((function(o){f(t(this).closest("[data-item-id]"))})),o.append(s),r.append(o),w.push(n)}else;})),t(c).val(w.join(","))}))},f=o=>{const s=t(o).closest("[data-pp-post-chooser], [data-pp-term-chooser]"),a=(t(s).find(".list-pills"),t(s).find(".list-pills+input")),p=t(o).data("item-id"),e=t(a).val().replace(p,"").split(",");t(a).val(e.join(",")),o.remove()},w=(o,s)=>{const a=t(`<div class="pp-quick-popup-overlay"><div class="pp-quick-popup">${s}</div></div>`);t(o).append(a),setTimeout((function(){t(a).fadeOut(300,(function(){t(this).remove()}))}),pwplData.quickPopupTtl)};t(".cb-section").click((function(o){const s=t(this).closest(".pp-form-row");t(s).next().fadeToggle()})),t.isFunction(t.fn.wpColorPicker)&&t(".pp-colour-chooser").wpColorPicker(),t("[data-pp-post-chooser] input.search-items, [data-pp-term-chooser] input.search-items").autocomplete({appendTo:t(event.target).closest("[data-pp-term-chooser], [data-pp-term-chooser]"),minLength:3,source:u,select:m}),t("[data-click-to-copy]").click((function(o){o.preventDefault();const s=t(this),a=t(s).data("click-to-copy");navigator.clipboard.writeText(a.textToCopy),w(s,a.messageWhenCopied)})),c()}}))}(jQuery);
